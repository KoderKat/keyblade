import scrapy
import re
import string
from scrapy.contrib.spiders import CrawlSpider, Rule
from scrapy.contrib.linkextractors.sgml import SgmlLinkExtractor
from deviant.items import DeviantItem
from time import gmtime, strftime

#BASE_DATA_DIR is the path to the data directory for storing all output files.
# recommendation: use the data directory in deviantart-spider/data/
BASE_DATA_DIR = "."

class deviantSpider(scrapy.contrib.spiders.CrawlSpider) :
  name = "deviant"
  allowed_domains = ["deviantart.com"]
  start_urls = ["http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=0","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=24","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=48","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=72","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=96","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=120","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=144","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=168","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=192","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=216","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=240","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=264","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=288","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=312","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=336","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=360","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=384","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=408","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=432","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=456","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=480","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=504","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=528","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=552","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=576","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=600","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=624","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=648","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=672","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=696","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=720","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=744","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=768","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=792","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=816","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=840","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=864","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=888","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=912","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=936","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=960","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=984","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1008","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1032","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1056","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1080","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1104","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1128","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1152","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1176","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1200","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1224","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1248","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1272","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1296","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1320","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1344","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1368","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1392","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1416","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1440","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1464","http://www.deviantart.com/browse/all/literature/fanfiction/drama/?offset=1488","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=0","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=24","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=48","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=72","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=96","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=120","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=144","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=168","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=192","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=216","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=240","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=264","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=288","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=312","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=336","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=360","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=384","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=408","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=432","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=456","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=480","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=504","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=528","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=552","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=576","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=600","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=624","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=648","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=672","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=696","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=720","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=744","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=768","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=792","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=816","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=840","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=864","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=888","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=912","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=936","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=960","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=984","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1008","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1032","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1056","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1080","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1104","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1128","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1152","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1176","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1200","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1224","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1248","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1272","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1296","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1320","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1344","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1368","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1392","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1416","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1440","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1464","http://www.deviantart.com/browse/all/literature/fanfiction/fantasy/?offset=1488","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=0","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=24","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=48","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=72","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=96","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=120","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=144","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=168","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=192","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=216","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=240","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=264","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=288","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=312","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=336","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=360","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=384","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=408","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=432","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=456","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=480","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=504","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=528","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=552","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=576","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=600","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=624","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=648","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=672","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=696","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=720","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=744","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=768","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=792","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=816","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=840","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=864","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=888","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=912","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=936","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=960","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=984","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1008","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1032","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1056","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1080","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1104","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1128","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1152","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1176","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1200","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1224","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1248","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1272","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1296","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1320","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1344","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1368","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1392","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1416","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1440","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1464","http://www.deviantart.com/browse/all/literature/fanfiction/general/?offset=1488","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=0","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=24","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=48","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=72","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=96","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=120","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=144","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=168","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=192","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=216","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=240","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=264","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=288","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=312","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=336","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=360","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=384","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=408","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=432","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=456","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=480","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=504","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=528","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=552","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=576","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=600","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=624","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=648","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=672","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=696","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=720","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=744","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=768","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=792","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=816","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=840","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=864","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=888","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=912","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=936","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=960","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=984","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1008","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1032","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1056","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1080","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1104","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1128","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1152","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1176","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1200","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1224","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1248","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1272","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1296","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1320","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1344","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1368","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1392","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1416","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1440","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1464","http://www.deviantart.com/browse/all/literature/fanfiction/horror/?offset=1488","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=0","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=24","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=48","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=72","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=96","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=120","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=144","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=168","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=192","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=216","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=240","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=264","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=288","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=312","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=336","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=360","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=384","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=408","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=432","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=456","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=480","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=504","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=528","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=552","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=576","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=600","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=624","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=648","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=672","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=696","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=720","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=744","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=768","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=792","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=816","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=840","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=864","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=888","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=912","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=936","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=960","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=984","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1008","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1032","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1056","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1080","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1104","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1128","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1152","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1176","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1200","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1224","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1248","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1272","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1296","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1320","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1344","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1368","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1392","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1416","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1440","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1464","http://www.deviantart.com/browse/all/literature/fanfiction/humor/?offset=1488","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=0","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=24","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=48","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=72","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=96","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=120","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=144","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=168","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=192","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=216","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=240","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=264","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=288","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=312","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=336","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=360","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=384","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=408","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=432","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=456","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=480","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=504","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=528","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=552","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=576","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=600","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=624","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=648","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=672","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=696","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=720","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=744","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=768","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=792","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=816","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=840","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=864","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=888","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=912","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=936","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=960","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=984","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1008","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1032","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1056","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1080","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1104","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1128","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1152","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1176","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1200","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1224","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1248","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1272","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1296","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1320","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1344","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1368","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1392","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1416","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1440","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1464","http://www.deviantart.com/browse/all/literature/fanfiction/romance/?offset=1488","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=0","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=24","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=48","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=72","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=96","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=120","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=144","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=168","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=192","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=216","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=240","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=264","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=288","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=312","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=336","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=360","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=384","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=408","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=432","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=456","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=480","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=504","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=528","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=552","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=576","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=600","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=624","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=648","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=672","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=696","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=720","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=744","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=768","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=792","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=816","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=840","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=864","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=888","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=912","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=936","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=960","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=984","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1008","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1032","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1056","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1080","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1104","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1128","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1152","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1176","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1200","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1224","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1248","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1272","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1296","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1320","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1344","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1368","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1392","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1416","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1440","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1464","http://www.deviantart.com/browse/all/literature/fanfiction/scifi/?offset=1488",
               ]

  ####################################################
  def parse(self, response) :
    it = 0
    titlelist = response.xpath('//a[@class="t"]')
    #print listitems

    for t in titlelist :
      #print "*************************************************"
      #print "it = " + str(it)
      #print "t = " + str(t)
      it = it+1

      item = DeviantItem()
      item['fandom'] = ''
      item['url_fandom'] = ''

      item['url_title'] = t.xpath('./@href').extract()[0].encode('ascii', 'ignore').decode('ascii').encode('ascii', 'ignore')
      #print "url_title = " + item['url_title']
      #print "***********************"

      request = scrapy.Request(item['url_title'], callback=self.parseTitle)
      request.meta['item'] = item

      yield request

  ####################################################
  ####################################################
  def parseTitle(self, response) :
    #print ".... parseTitle .... " + str(response)
    item = response.meta['item']
    item = self.getTitleInfo(item, response)
    item = self.getAuthorInfo(item, response)
    item = self.getGenreInfo(item, response)
    item['author_rating'] = ''
    #item = self.getTextInfo(item, response)
    item['title_text'] = '' #do not save text
    item['wc'] = ''
    item['numchs'] = '0'

    self.saveInfo(item, response)

    return item

  ####################################################
  def getTitleInfo(self, item, response) :
    #print ".... getTitleInfo...."

    # get title
    title_raw = response.xpath("//div/h2/a/text()").extract()
    #print "title_raw = " + str(title_raw)
    title = title_raw[0].encode('ascii', 'ignore').decode('ascii').encode('ascii', 'ignore')
    title = str(title).translate( None, string.whitespace )
    #print "title = " + title

    title = re.sub(' ', '', title)
    title = re.sub('\'', '', title)
    title = title.replace("|", "")
    title = title.replace("!", "")
    title = title.replace(",", "")
    title = title.replace(".", "")
    title = title.replace(":", "")
    title = title.replace("(", "")
    title = title.replace(")", "")
    title = title.replace("{", "")
    title = title.replace("}", "")

    item['title'] = title
    return item

  ####################################################
  def getAuthorInfo(self, item, response) :
    #print ".... getAuthorInfo...."

    # get author
    author_raw = response.xpath("//span[@class='username-with-symbol u']/a/text()").extract()
    #print "author_raw = " + str(author_raw)
    author = author_raw[0].encode('ascii', 'ignore').decode('ascii').encode('ascii', 'ignore')
    #print "author = " + author

    # get url_author
    url_author_raw = response.xpath("//span[@class='username-with-symbol u']/a/@href").extract()
    #print "url_author_raw = " + str(url_author_raw)
    url_author = url_author_raw[0].encode('ascii', 'ignore').decode('ascii').encode('ascii', 'ignore')
    #print "url_author = " + str(url_author)

    item['author'] = author
    item['url_author'] = url_author

    return item

  ####################################################
  def getGenreInfo(self, item, response) :
    #print ".... getGenreInfo...."

    # get genre
    genre_raw = response.xpath("//div/div/div/div/div/div/div/div/div/div/div/div/div/ul/li/span/a/span/text()").extract()[2]
    #print "genre_raw = " + str(genre_raw)
    genre = genre_raw.encode('ascii', 'ignore').decode('ascii').encode('ascii', 'ignore')
    #print "genre = " + genre
    item['genre'] = genre.lower()
    return item

  ####################################################
  def getTextInfo(self, item, response) :
    #print ".... getTextInfo ...."

    # get text
    text_raw = response.xpath("//div[@class='text']/text()").extract()

    text = []
    for t in text_raw :
      #print "t = " + str(t)
      t = t.encode('ascii', 'ignore').decode('ascii').encode('ascii', 'ignore')
      #print "t1 = " + str(t)
      t = re.sub('\n', '', t)
      #print "t2 = " + str(t)
      text.append( t )
    #print ">>>>>>>>>>> " + str(text)
    cleanText = " ".join(text)
    #print ">>>>>>>>>>> cleanText = " + cleanText

    item['title_text'] = cleanText
    return item

  ####################################################
  def saveInfo(self, item, response) :
    #print ".... saveInfo ...." + str(response)

    title = item['title']
    title = re.sub(' ', '', title)
    title = re.sub('\'', '', title)
    #print "*********** title = " + title
    fic_info_filename = BASE_DATA_DIR + title + "_info" + ".txt"
    fic_text_filename = BASE_DATA_DIR + title + "_text" + ".txt"

    #print "fic_info_filename = " + fic_info_filename
    #print "fic_text_filename = " + fic_text_filename

    info_file = open(fic_info_filename, 'w')
    info_file.write("###" + '\n')
    info_file.write(item['fandom'] + '\n')
    info_file.write(item['url_fandom'] + '\n')
    info_file.write(item['title'] + '\n')
    info_file.write(item['url_title'] + '\n')
    info_file.write(item['author'] + '\n')
    info_file.write(item['url_author'] + '\n')
    info_file.write(item['genre'] + '\n')
    info_file.write(item['wc'] + '\n')
    info_file.write(item['numchs'] + '\n')
    info_file.write("###")
    info_file.close()

    #text_file = open(fic_text_filename, 'w')
    #text_file.write("###")
    #text_file.write(item['title_text'])
    #text_file.write("###")
    #text_file.close()

